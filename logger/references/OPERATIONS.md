# 操作流程详解

> 记录系统的详细操作步骤和工作流程（经验 + 知识）

---

## 一、查找已有经验（优先执行）

### 步骤

1. **判断问题领域**：确定应该检索哪个分类目录
2. **读取相关文件**：读取对应分类的 md 文件内容
3. **搜索匹配记录**：根据关键词、标签查找相关经验
4. **呈现给用户**：
   - 如果找到相关记录，展示内容并询问是否适用
   - 如果未找到，**转入"网络搜索"步骤**

### 搜索技巧

- 使用关键词匹配：如"协程"、"yield"、"DOTS"
- 查看标签过滤：根据场景快速筛选
- 检查状态标记：优先使用 ✅ 已验证的内容

---

## 二、网络搜索（经验未找到时）

### 步骤

1. **告知用户**："未在经验记录中找到相关内容，正在上网搜索..."
2. **构建搜索关键词**：根据问题提取核心关键词
3. **执行网络搜索**：使用 `#fetch` 工具搜索相关资料
4. **优先搜索来源**（按优先级）：
   - 官方文档（Unity Docs、Microsoft Docs、MDN 等）
   - 官方论坛/讨论区
   - Stack Overflow
   - 知名技术博客
5. **整理搜索结果**：
   - 提取关键信息和解决方案
   - 记录参考链接来源
   - 标注信息的时效性（发布日期/版本）
6. **呈现给用户**：展示搜索到的解决方案
7. **询问是否记录**：如果解决了问题，询问是否将此经验记录下来

### 搜索关键词提取

| 问题类型 | 关键词示例 |
|---------|------------|
| Unity 协程 | `yield return null`、`coroutine`、`StartCoroutine` |
| Unity Shader | `Shader Graph`、`URP`、`HLSL`、`URP Lit` |
| Git 冲突 | `merge conflict`、`rebase`、`git cherry-pick` |
| C# 异步 | `async/await`、`Task`、`CancellationToken` |

---

## 三、记录新经验

### 步骤

1. **同步仓库**：执行"仓库同步流程"中的"拉取最新"步骤
2. **识别内容**：判断当前对话中是否有值得记录的经验或结论
3. **确定分类**：根据内容主题选择对应的分类文件
4. **检查重复**：查看目标文件中是否已有类似记录
   - 如有类似记录，转为"更新"操作
   - 如无类似记录，执行"新增"操作
5. **提取要点**：
   - 简短标题（一句话概括）
   - 问题/场景描述
   - 解决方案/结论
   - 关键代码片段（如有）
   - 相关标签
   - **参考链接**（尽量提供官方文档或可信来源）
6. **格式化内容**：按照上述模板格式化
7. **追加写入**：将内容追加到对应分类文件末尾
8. **推送更改**：执行"仓库同步流程"中的"提交推送"步骤
9. **确认反馈**：告知用户已记录到哪个文件，并确认已同步到远程仓库

### 分类选择指南

| 问题类型 | 推荐分类 |
|---------|----------|
| Unity C# 脚本 | `unity/csharp.md` |
| Unity Shader | `unity/shader.md` |
| Unity 物理 | `unity/physics.md` |
| Unity 动画 | `unity/animation.md` |
| Unity UI | `unity/ui.md` |
| Unity 性能 | `unity/performance.md` |
| Unity 网络 | `unity/networking.md` |
| Unity 编辑器 | `unity/editor.md` |
| Unity 资源 | `unity/asset.md` |
| C# 语法 | `csharp/syntax.md` |
| C# 异步 | `csharp/async.md` |
| C# LINQ | `csharp/linq.md` |
| C# 设计模式 | `csharp/patterns.md` |
| Git 操作 | `git/commands.md` |
| Python 语法 | `python/syntax.md` |
| Python 库 | `python/libraries.md` |
| Claude Code | `anthropic/claude-code.md` |
| VS Code | `vscode/copilot.md` |

---

## 四、更新已有经验

### 步骤

1. **同步仓库**：执行"仓库同步流程"中的"拉取最新"步骤
2. **定位记录**：找到需要更新的经验条目
3. **判断更新类型**：
   - **补充**：添加新的信息、代码示例、参考链接
   - **修正**：纠正错误或过时的内容
   - **标记过时**：将状态改为 🔄 已过时
4. **执行更新**：
   - 更新"更新日期"字段
   - 在"验证记录"中添加本次验证/更新说明
5. **状态保持**：
   - 补充/修正：状态保持 ✅ 已验证
   - 标记过时：状态改为 🔄 已过时
6. **推送更改**：执行"仓库同步流程"中的"提交推送"步骤
7. **反馈用户**：说明更新了什么内容，并确认已同步到远程仓库

### 更新类型处理

#### 补充（内容基本正确，需要补充或微调）

```markdown
**验证记录**：
- [YYYY-MM-DD] 补充：添加了版本兼容性说明
```

#### 修正（核心方案有误或有更好替代）

**小幅修正**（保留历史记录）：
```markdown
**操作步骤**：
1. 保留原有内容结构
2. 在需要修正的部分添加更正说明
3. 更新"更新日期"字段
4. 在"验证记录"中添加修正说明
```

#### 重大修正（保留历史，明确新旧方案）

```markdown
**操作步骤**：
1. 将原方案内容移至"历史记录"部分（不删除，保留参考）
2. 在正文添加新的正确方案
3. 明确标注新旧方案的区别和适用场景
```

---

## 五、验证与修正

### 触发验证的场景

| 场景 | 说明 |
|------|------|
| **引用时验证** | 当引用某条经验回答用户问题时，根据当前上下文判断其是否仍然适用 |
| **用户反馈** | 用户表示"这个方法不行"、"不对"、"有问题"、"这个过时了" |
| **版本更新** | 讨论中发现相关技术/框架有重大版本更新 |
| **矛盾检测** | 新记录的经验与已有经验产生冲突 |

### 验证方法

#### 上下文对比验证

- 检查经验记录的日期和适用版本
- 对比用户当前使用的技术栈版本
- 判断核心 API 或方法是否仍然存在

#### 官方文档验证

- 查阅相关技术的官方文档
- 检查是否有 Breaking Changes 或 Deprecation 警告
- 确认推荐的最佳实践是否改变

#### 实践验证

- 如果用户提供了具体错误信息，分析原因
- 判断是经验本身的问题还是使用场景不同
- 必要时建议用户进行简单测试验证

### 修正流程

根据验证结果，采取不同的修正策略：

| 验证结果 | 处理方式 |
|----------|----------|
| **明显过时** | 标记待验证，标记过时原因 |
| **部分正确** | 执行小幅修正，补充适用条件说明 |
| **完全错误** | 执行重大修正或废弃/重写流程 |
| **场景不同** | 补充适用条件说明，无需修正 |

### 冲突处理

当新记录的经验与已有经验存在矛盾时：

1. **场景不同**：两条经验都保留，明确标注各自适用场景
2. **版本差异**：标注版本适用范围，新版本方案作为推荐
3. **真正冲突**：验证后保留正确的，修正或废弃错误的
4. **关联处理**：在相关经验间添加互相引用链接，标注适用条件

### 用户反馈处理

当用户表示经验有问题时的处理流程：

1. **收集信息**：
   - 询问具体出了什么问题（错误信息、异常行为等）
   - 确认用户的技术环境（版本、平台等）
   - 了解用户的具体使用场景
2. **分析问题**：
   - 判断是经验本身错误还是场景不适用
   - 检查是否是版本差异导致的问题
   - 确认是否有遗漏的前置条件
3. **采取行动**：
   - 如果经验有误：执行相应的修正流程
   - 如果场景不适用：补充适用条件说明
   - 如果是版本问题：添加版本兼容性说明
4. **反馈确认**：
   - 告知用户分析结果和处理方式
   - 提供正确的解决方案
   - 询问是否解决了用户的问题

---

## 六、大型内容处理

> 当经验内容非常丰富（如完整的设计文档、架构图解）时，采用"摘要 + 独立文档"的策略。

### 触发条件

| 条件 | 说明 |
|------|------|
| 内容长度超过 50 行 | 考虑拆分为独立文档 |
| 包含大量图表代码 | 包含 Mermaid 流程图、代码块等 |
| 属于完整技术方案 | 如 API 文档、架构设计、实现指南 |
| 用户明确要求保存为独立文档 | 用户说"把这个保存为独立文档" |

### 处理流程

1. **创建独立文档**：
   - 路径：`[分类]/docs/[英文_下划线_命名].md`
   - 例如：`unity/docs/VR_Variant_Collector_Architecture.md`
2. **编写摘要记录**：
   - 在主分类文件中添加一条标准记录
   - 内容：背景、核心结论、关键点
   - **关键步骤**：在记录末尾添加 `详细文档`链接，指向刚才创建的独立文档
   - 链接格式：`- [文档标题](./docs/filename.md)`
3. **填充独立文档**：包含完整的所有细节、代码和图表

### 示例

```markdown
## VR Shader 变体收集器架构

**日期**：2024-01-30
**标签**：#unity #shader #urp #variant-collector
**状态**：✅ 已验证

**问题/场景**：

Unity URP 项目中 Shader 变体过多导致打包缓慢，需要设计一个变体收集器来统一管理和编译。

**解决方案/结论**：

设计了一套基于 Addressable Asset 的变体收集器架构，支持多种打包策略和优化。

**关键点**：
1. 关键字驱动的变体定义
2. 自动变体收集和去重
3. 支持自定义打包策略（Include/Exclude）
4. 与 URP Graph 集成
5. 编辑器扩展简化配置流程

**详细文档**：- [完整架构文档](./unity/docs/VR_Variant_Collector_Architecture.md)
```

### 优势

| 优势 | 说明 |
|------|------|
| SKILL.md 更小 | 主文件只保留摘要，Token 消耗更少 |
| 查找效率 | 核心内容在主文件，详细内容在独立文档 |
| 维护简单 | 大型文档独立管理，不影响主框架 |
| 按需加载 | 详细文档按需引用，不影响日常使用 |

---

## 七、知识记录流程

### 步骤

1. **同步仓库**：执行"仓库同步流程"中的"拉取最新"步骤
2. **识别知识类型**：判断属于哪个分类（AI/图形学/Unity/编程/HLSL/工具等）
3. **确定目标文件**：根据具体主题选择或创建对应的 md 文件
4. **检查是否已存在**：避免重复记录相同知识点
5. **提取要点**：
   - 简短标题（知识点名称）
   - 分类和关键词
   - 来源信息（书籍/文档/课程等）
   - 定义/概念
   - 原理/详解
   - 关键点
   - 示例（如有）
6. **格式化内容**：按照知识条目模板格式化
7. **追加写入**：将内容追加到目标文件末尾
8. **推送更改**：执行"仓库同步流程"中的"提交推送"步骤
9. **确认反馈**：告知用户已记录到哪个文件，并确认已同步到远程仓库

### 分类选择指南

| 知识类型 | 推荐分类 |
|---------|----------|
| AI Agent 规范、提示工程 | `ai/agent-skills.md` |
| 渲染管线、光照理论、PBR | `graphics/rendering-pipeline.md` |
| 色彩空间、伽马校正 | `graphics/color-space.md` |
| SDF、字体渲染 | `graphics/sdf.md` |
| URP 原理、SRP 架构 | `unity/urp.md` |
| C# 语言特性 | `programming/csharp.md` |
| HLSL 语法、语义 | `hlsl/syntax.md` |
| Git 原理 | `tools/git.md` |

### 与经验记录的区别

| 维度 | 知识记录 | 经验记录 |
|------|----------|----------|
| 触发词 | "记一下这个知识点"、"这个概念记录下来" | "记录一下"、"总结经验"、"保存结论" |
| 格式 | 概念 → 原理 → 要点 | 问题 → 解决方案 → 验证 |
| 存放位置 | `data/knowledge/` | `data/experiences/` |
| 状态标记 | 可信度评级 | 验证状态标记 |
| 时效性 | 相对稳定 | 可能随版本变化 |

### 相互引用

**在知识文档中关联经验**：
```markdown
### 与经验关联
- 实践验证：[相关经验标题](../../data/experiences/分类/文件.md#锚点)
```

**在经验文档中关联知识**：
```markdown
**理论基础**：
- 参考知识：[相关知识点](../../data/knowledge/分类/文件.md#锚点)
```
